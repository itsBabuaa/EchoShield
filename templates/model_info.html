{% extends "base.html" %}

{% block title %}Model Info - EchoShield{% endblock %}

{% block content %}
<div class="model-info-container">
    <h1 class="page-title">Model Performance & Architecture</h1>
    <p class="model-intro">Our BiLSTM-based deepfake detection model is trained on thousands of audio samples to achieve industry-leading accuracy.</p>
    
    <!-- Model Disclaimer -->
    <div class="model-disclaimer">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="16" x2="12" y2="12"/>
            <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
        <div>
            <strong>Note:</strong> Our model can be wrong sometimes. These metrics are based on our test dataset and real-world performance may vary depending on audio quality and recording conditions. We recommend using this tool alongside other verification methods.
        </div>
    </div>
    
    <!-- Performance Metrics -->
    <section class="metrics-section">
        <h2>Performance Metrics</h2>
        <div class="metrics-grid">
            <div class="metric-card primary">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="6"/>
                        <circle cx="12" cy="12" r="2"/>
                    </svg>
                </div>
                <div class="metric-value">{{ "%.1f"|format(metrics.accuracy) }}%</div>
                <div class="metric-label">Accuracy</div>
                <div class="metric-description">Overall correctness of predictions</div>
            </div>
            
            <div class="metric-card highlight">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                </div>
                <div class="metric-value">{{ "%.1f"|format(metrics.precision) }}%</div>
                <div class="metric-label">Precision</div>
                <div class="metric-description">Accuracy of positive predictions</div>
            </div>
            
            <div class="metric-card primary">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    </svg>
                </div>
                <div class="metric-value">{{ "%.1f"|format(metrics.recall) }}%</div>
                <div class="metric-label">Recall</div>
                <div class="metric-description">Ability to find all positives</div>
            </div>
            
            <div class="metric-card highlight">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 3v18M3 12h18M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4"/>
                    </svg>
                </div>
                <div class="metric-value">{{ "%.1f"|format(metrics.f1_score) }}%</div>
                <div class="metric-label">F1 Score</div>
                <div class="metric-description">Harmonic mean of precision & recall</div>
            </div>
            
            <div class="metric-card highlight">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                </div>
                <div class="metric-value">{{ "%.1f"|format(metrics.auc_roc) }}%</div>
                <div class="metric-label">AUC-ROC</div>
                <div class="metric-description">Area under ROC curve</div>
            </div>
            
            <div class="metric-card primary">
                <div class="metric-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                </div>
                <div class="metric-value">&lt;5s</div>
                <div class="metric-label">Inference Time</div>
                <div class="metric-description">Average prediction speed</div>
            </div>
        </div>
    </section>
    
    <!-- ROC Curve Visualization -->
    <section class="visualization-section">
        <h2>ROC Curve Analysis</h2>
        <div class="roc-container">
            <div class="roc-info">
                <h3>What is ROC?</h3>
                <p>The Receiver Operating Characteristic (ROC) curve illustrates the diagnostic ability of our binary classifier. It plots the True Positive Rate against the False Positive Rate at various threshold settings.</p>
                
                <div class="roc-stats">
                    <div class="roc-stat">
                        <span class="stat-label">AUC Score:</span>
                        <span class="stat-value">{{ "%.1f"|format(metrics.auc_roc) }}%</span>
                    </div>
                    <div class="roc-stat">
                        <span class="stat-label">Interpretation:</span>
                        <span class="stat-value">Good</span>
                    </div>
                    <div class="roc-stat">
                        <span class="stat-label">True Positive Rate:</span>
                        <span class="stat-value">{{ "%.1f"|format(metrics.recall) }}%</span>
                    </div>
                    <div class="roc-stat">
                        <span class="stat-label">Precision:</span>
                        <span class="stat-value">{{ "%.1f"|format(metrics.precision) }}%</span>
                    </div>
                </div>
                
                <div class="interpretation-guide">
                    <h4>AUC Score Interpretation:</h4>
                    <ul>
                        <li><strong>0.90 - 1.00:</strong> Excellent</li>
                        <li><strong>0.80 - 0.90:</strong> Good</li>
                        <li><strong>0.70 - 0.80:</strong> Fair</li>
                        <li><strong>0.60 - 0.70:</strong> Poor</li>
                        <li><strong>0.50 - 0.60:</strong> Fail</li>
                    </ul>
                </div>
            </div>
            
            <div class="roc-chart">
                <svg viewBox="0 0 400 400" class="roc-svg">
                    <!-- Grid -->
                    <line x1="50" y1="50" x2="50" y2="350" stroke="#333" stroke-width="2"/>
                    <line x1="50" y1="350" x2="350" y2="350" stroke="#333" stroke-width="2"/>
                    
                    <!-- Grid lines -->
                    <line x1="50" y1="110" x2="350" y2="110" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="50" y1="170" x2="350" y2="170" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="50" y1="230" x2="350" y2="230" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="50" y1="290" x2="350" y2="290" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    
                    <line x1="110" y1="50" x2="110" y2="350" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="170" y1="50" x2="170" y2="350" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="230" y1="50" x2="230" y2="350" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="290" y1="50" x2="290" y2="350" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/>
                    
                    <!-- Diagonal reference line (random classifier) -->
                    <line x1="50" y1="350" x2="350" y2="50" stroke="#666" stroke-width="2" stroke-dasharray="10,5"/>
                    
                    <!-- ROC Curve (excellent performance) -->
                    <path d="M 50 350 Q 60 200, 80 120 T 150 60 T 350 50" 
                          fill="none" 
                          stroke="url(#rocGradient)" 
                          stroke-width="3"/>
                    
                    <!-- Area under curve -->
                    <path d="M 50 350 Q 60 200, 80 120 T 150 60 T 350 50 L 350 350 Z" 
                          fill="url(#rocGradient)" 
                          opacity="0.2"/>
                    
                    <!-- Labels -->
                    <text x="200" y="380" text-anchor="middle" fill="#8b5cf6" font-size="14">False Positive Rate</text>
                    <text x="20" y="200" text-anchor="middle" fill="#8b5cf6" font-size="14" transform="rotate(-90 20 200)">True Positive Rate</text>
                    
                    <!-- Axis labels -->
                    <text x="50" y="365" text-anchor="middle" fill="#999" font-size="12">0.0</text>
                    <text x="350" y="365" text-anchor="middle" fill="#999" font-size="12">1.0</text>
                    <text x="35" y="355" text-anchor="end" fill="#999" font-size="12">0.0</text>
                    <text x="35" y="55" text-anchor="end" fill="#999" font-size="12">1.0</text>
                    
                    <!-- AUC label -->
                    <text x="250" y="250" fill="#8b5cf6" font-size="16" font-weight="bold">AUC = {{ "%.2f"|format(metrics.auc_roc / 100) }}</text>
                    
                    <!-- Gradient definition -->
                    <defs>
                        <linearGradient id="rocGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
        </div>
    </section>
    
    <!-- Training Data -->
    <section class="data-section">
        <h2>Training Data</h2>
        <div class="data-grid">
            <div class="data-card">
                <div class="data-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                </div>
                <div class="data-value">{{ "{:,}".format(metrics.training_samples) }}</div>
                <div class="data-label">Training Samples</div>
            </div>
            <div class="data-card">
                <div class="data-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <div class="data-value">{{ "{:,}".format(metrics.validation_samples) }}</div>
                <div class="data-label">Validation Samples</div>
            </div>
            <div class="data-card">
                <div class="data-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.5 10c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v5c0 .83-.67 1.5-1.5 1.5z"/>
                        <path d="M20.5 10H19V8.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        <path d="M9.5 14c.83 0 1.5.67 1.5 1.5v5c0 .83-.67 1.5-1.5 1.5S8 21.33 8 20.5v-5c0-.83.67-1.5 1.5-1.5z"/>
                        <path d="M3.5 14H5v1.5c0 .83-.67 1.5-1.5 1.5S2 16.33 2 15.5 2.67 14 3.5 14z"/>
                        <path d="M14 14.5c0-.83.67-1.5 1.5-1.5h5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-5c-.83 0-1.5-.67-1.5-1.5z"/>
                        <path d="M15.5 19H14v1.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"/>
                        <path d="M10 9.5C10 8.67 9.33 8 8.5 8h-5C2.67 8 2 8.67 2 9.5S2.67 11 3.5 11h5c.83 0 1.5-.67 1.5-1.5z"/>
                        <path d="M8.5 5H10V3.5C10 2.67 9.33 2 8.5 2S7 2.67 7 3.5 7.67 5 8.5 5z"/>
                    </svg>
                </div>
                <div class="data-value">
                    {% if metrics.test_samples is number %}
                    {{ "{:,}".format(metrics.test_samples) }}
                    {% else %}
                    {{ metrics.test_samples }}
                    {% endif %}
                </div>
                <div class="data-label">Test Samples</div>
            </div>
        </div>
        
        <div class="dataset-info">
            <h3>Dataset: SceneFake</h3>
            <p>Our model is trained on the SceneFake dataset, which contains authentic and synthetic audio samples covering various scenarios, speakers, and generation techniques.</p>
            <ul>
                <li><strong>Real Audio:</strong> Genuine human speech recordings</li>
                <li><strong>Fake Audio:</strong> AI-generated speech from multiple synthesis methods</li>
                <li><strong>Diversity:</strong> Multiple speakers, accents, and recording conditions</li>
            </ul>
        </div>
    </section>
    
    <!-- Model Architecture -->
    <section class="architecture-section">
        <h2>Model Architecture</h2>
        
        <div class="arch-overview">
            <div class="arch-stat">
                <span class="arch-label">Total Parameters:</span>
                <span class="arch-value">{{ metrics.parameters if metrics.parameters != 'TBD' else 'Calculating...' }}</span>
            </div>
            <div class="arch-stat">
                <span class="arch-label">Input Shape:</span>
                <span class="arch-value">{{ metrics.architecture.input_shape }}</span>
            </div>
            <div class="arch-stat">
                <span class="arch-label">Model Type:</span>
                <span class="arch-value">BiLSTM</span>
            </div>
        </div>
        
        <div class="layers-container">
            <h3>Network Layers</h3>
            
            <!-- Neural Network Visualization -->
            <div class="neural-network-viz">
                <svg viewBox="0 0 800 400" class="network-svg">
                    <!-- Input Layer -->
                    <g class="layer-group">
                        <text x="50" y="30" class="layer-label">Input Layer</text>
                        <circle cx="80" cy="100" r="12" class="neuron input-neuron"/>
                        <circle cx="80" cy="150" r="12" class="neuron input-neuron"/>
                        <circle cx="80" cy="200" r="12" class="neuron input-neuron"/>
                        <circle cx="80" cy="250" r="12" class="neuron input-neuron"/>
                        <circle cx="80" cy="300" r="12" class="neuron input-neuron"/>
                        <text x="80" y="330" class="layer-info">MFCC Features</text>
                        <text x="80" y="350" class="layer-info-small">(40, 174)</text>
                    </g>
                    
                    <!-- Connections Input to BiLSTM1 -->
                    <g class="connections">
                        <line x1="92" y1="100" x2="248" y2="120" class="connection"/>
                        <line x1="92" y1="150" x2="248" y2="160" class="connection"/>
                        <line x1="92" y1="200" x2="248" y2="200" class="connection"/>
                        <line x1="92" y1="250" x2="248" y2="240" class="connection"/>
                        <line x1="92" y1="300" x2="248" y2="280" class="connection"/>
                        <line x1="92" y1="100" x2="248" y2="160" class="connection-light"/>
                        <line x1="92" y1="150" x2="248" y2="200" class="connection-light"/>
                        <line x1="92" y1="200" x2="248" y2="240" class="connection-light"/>
                        <line x1="92" y1="250" x2="248" y2="280" class="connection-light"/>
                    </g>
                    
                    <!-- BiLSTM Layer 1 -->
                    <g class="layer-group">
                        <text x="220" y="30" class="layer-label">BiLSTM-1</text>
                        <rect x="240" y="110" width="40" height="180" rx="8" class="lstm-cell"/>
                        <text x="260" y="205" class="lstm-text">128</text>
                        <text x="260" y="310" class="layer-info">Bidirectional</text>
                        <text x="260" y="330" class="layer-info-small">LSTM Units</text>
                    </g>
                    
                    <!-- Connections BiLSTM1 to Dropout1 -->
                    <g class="connections">
                        <line x1="280" y1="140" x2="348" y2="140" class="connection"/>
                        <line x1="280" y1="180" x2="348" y2="180" class="connection"/>
                        <line x1="280" y1="220" x2="348" y2="220" class="connection"/>
                        <line x1="280" y1="260" x2="348" y2="260" class="connection"/>
                    </g>
                    
                    <!-- Dropout Layer 1 -->
                    <g class="layer-group">
                        <text x="330" y="30" class="layer-label">Dropout</text>
                        <circle cx="360" cy="140" r="10" class="neuron dropout-neuron"/>
                        <circle cx="360" cy="180" r="10" class="neuron dropout-neuron"/>
                        <circle cx="360" cy="220" r="10" class="neuron dropout-neuron"/>
                        <circle cx="360" cy="260" r="10" class="neuron dropout-neuron"/>
                        <text x="360" y="290" class="layer-info-small">30% dropout</text>
                    </g>
                    
                    <!-- Connections Dropout1 to BiLSTM2 -->
                    <g class="connections">
                        <line x1="370" y1="140" x2="448" y2="130" class="connection"/>
                        <line x1="370" y1="180" x2="448" y2="170" class="connection"/>
                        <line x1="370" y1="220" x2="448" y2="210" class="connection"/>
                        <line x1="370" y1="260" x2="448" y2="250" class="connection"/>
                    </g>
                    
                    <!-- BiLSTM Layer 2 -->
                    <g class="layer-group">
                        <text x="430" y="30" class="layer-label">BiLSTM-2</text>
                        <rect x="440" y="120" width="40" height="140" rx="8" class="lstm-cell"/>
                        <text x="460" y="195" class="lstm-text">64</text>
                        <text x="460" y="280" class="layer-info">Bidirectional</text>
                        <text x="460" y="300" class="layer-info-small">LSTM Units</text>
                    </g>
                    
                    <!-- Connections BiLSTM2 to Dropout2 -->
                    <g class="connections">
                        <line x1="480" y1="150" x2="548" y2="150" class="connection"/>
                        <line x1="480" y1="190" x2="548" y2="190" class="connection"/>
                        <line x1="480" y1="230" x2="548" y2="230" class="connection"/>
                    </g>
                    
                    <!-- Dropout Layer 2 -->
                    <g class="layer-group">
                        <text x="530" y="30" class="layer-label">Dropout</text>
                        <circle cx="560" cy="150" r="10" class="neuron dropout-neuron"/>
                        <circle cx="560" cy="190" r="10" class="neuron dropout-neuron"/>
                        <circle cx="560" cy="230" r="10" class="neuron dropout-neuron"/>
                        <text x="560" y="260" class="layer-info-small">30% dropout</text>
                    </g>
                    
                    <!-- Connections Dropout2 to Dense -->
                    <g class="connections">
                        <line x1="570" y1="150" x2="648" y2="180" class="connection"/>
                        <line x1="570" y1="190" x2="648" y2="200" class="connection"/>
                        <line x1="570" y1="230" x2="648" y2="220" class="connection"/>
                    </g>
                    
                    <!-- Dense Layer -->
                    <g class="layer-group">
                        <text x="630" y="30" class="layer-label">Dense</text>
                        <circle cx="660" cy="180" r="12" class="neuron dense-neuron"/>
                        <circle cx="660" cy="220" r="12" class="neuron dense-neuron"/>
                        <text x="660" y="250" class="layer-info">32 units</text>
                        <text x="660" y="270" class="layer-info-small">ReLU</text>
                    </g>
                    
                    <!-- Connections Dense to Output -->
                    <g class="connections">
                        <line x1="672" y1="180" x2="728" y2="190" class="connection"/>
                        <line x1="672" y1="220" x2="728" y2="210" class="connection"/>
                    </g>
                    
                    <!-- Output Layer -->
                    <g class="layer-group">
                        <text x="690" y="30" class="layer-label">Output</text>
                        <circle cx="740" cy="190" r="14" class="neuron output-neuron"/>
                        <circle cx="740" cy="210" r="14" class="neuron output-neuron"/>
                        <text x="740" y="240" class="layer-info">2 classes</text>
                        <text x="740" y="260" class="layer-info-small">Softmax</text>
                        <text x="740" y="280" class="layer-info-small">Real/Fake</text>
                    </g>
                    
                    <!-- Arrows for data flow -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="var(--primary-color)" opacity="0.6"/>
                        </marker>
                    </defs>
                    <line x1="30" y1="370" x2="770" y2="370" stroke="var(--primary-color)" stroke-width="2" marker-end="url(#arrowhead)" opacity="0.4"/>
                    <text x="400" y="390" class="flow-label">Data Flow Direction â†’</text>
                </svg>
            </div>
            
            <div class="layers-list">
                {% for layer in metrics.architecture.layers %}
                <div class="layer-item">
                    <div class="layer-number">{{ loop.index }}</div>
                    <div class="layer-name">{{ layer }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="features-container">
            <h3>Feature Extraction</h3>
            <div class="features-grid">
                <div class="feature-item">
                    <span class="feature-label">Type:</span>
                    <span class="feature-value">{{ metrics.features.type }}</span>
                </div>
                <div class="feature-item">
                    <span class="feature-label">Coefficients:</span>
                    <span class="feature-value">{{ metrics.features.n_coefficients }}</span>
                </div>
                <div class="feature-item">
                    <span class="feature-label">Sample Rate:</span>
                    <span class="feature-value">{{ "{:,}".format(metrics.features.sample_rate) }} Hz</span>
                </div>
                <div class="feature-item">
                    <span class="feature-label">Max Length:</span>
                    <span class="feature-value">{{ metrics.features.max_length }} frames</span>
                </div>
            </div>
            
            <div class="mfcc-explanation">
                <h4>What are MFCCs?</h4>
                <p>Mel-Frequency Cepstral Coefficients (MFCCs) are features that represent the short-term power spectrum of audio. They capture the unique characteristics of human speech and are highly effective for distinguishing between real and synthetic audio.</p>
            </div>
        </div>
    </section>
    
    <!-- Training Configuration -->
    <section class="training-section">
        <h2>Training Configuration</h2>
        <div class="training-grid">
            <div class="training-card">
                <div class="training-label">Epochs</div>
                <div class="training-value">{{ metrics.epochs }}</div>
            </div>
            <div class="training-card">
                <div class="training-label">Batch Size</div>
                <div class="training-value">{{ metrics.batch_size }}</div>
            </div>
            <div class="training-card">
                <div class="training-label">Learning Rate</div>
                <div class="training-value">{{ metrics.learning_rate }}</div>
            </div>
            <div class="training-card">
                <div class="training-label">Optimizer</div>
                <div class="training-value">{{ metrics.optimizer.type }}</div>
            </div>
            <div class="training-card">
                <div class="training-label">Loss Function</div>
                <div class="training-value">{{ metrics.loss_function }}</div>
            </div>
            <div class="training-card">
                <div class="training-label">Gradient Clipping</div>
                <div class="training-value">{{ metrics.optimizer.clipnorm }}</div>
            </div>
        </div>
        
        <div class="callbacks-section">
            <h3>Training Callbacks</h3>
            <ul class="callbacks-list">
                {% for callback in metrics.callbacks %}
                <li>{{ callback }}</li>
                {% endfor %}
            </ul>
        </div>
    </section>
    
    <!-- CTA -->
    <section class="cta-section">
        <h2>Try It Yourself</h2>
        <p>Experience our high-performance model in action</p>
        <a href="/detect" class="btn-primary btn-large">Detect Deepfakes Now</a>
    </section>
</div>
{% endblock %}
